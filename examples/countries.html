<!DOCTYPE html>
<meta charset="utf-8">
<title>D3 Country Maps | TechSlides</title>
<style>
path:hover{
  fill: #ccc;
}
.text{
  font-size:10px;
  text-transform:capitalize;
}
#container {
  margin:10px 10%;
  border:2px solid #000;
  border-radius: 5px;
  height:100%;
  overflow:hidden;
  background: #F0F8FF;
}
.hidden { 
  display: none; 
}
div.tooltip {
  color: #222; 
  background: #fff; 
  padding: .5em; 
  text-shadow: #f5f5f5 0 1px 0;
  border-radius: 2px; 
  box-shadow: 0px 0px 2px 0px #a6a6a6; 
  opacity: 0.9; 
  position: absolute;
}
</style>
</head>
<body>

  <h1>Explore Countries with D3 and TopoJSON</h1>
  <p>
  	<label>Select a country</label>
  	<select id="selectBox" onchange="window.location='https://techslides.github.io/D3-Maps/examples/countries.html?country='+this.value;">
		<option>Afghanistan</option>
		<option>Akrotiri_Sovereign_Base_Area</option>
		<option>Aland</option>
		<option>Albania</option>
		<option>Algeria</option>
		<option>American_Samoa</option>
		<option>Andorra</option>
		<option>Angola</option>
		<option>Anguilla</option>
		<option>Antarctica</option>
		<option>Antigua_and_Barbuda</option>
		<option>Argentina</option>
		<option>Armenia</option>
		<option>Aruba</option>
		<option>Ashmore_and_Cartier_Islands</option>
		<option>Australia</option>
		<option>Austria</option>
		<option>Azerbaijan</option>
		<option>Bahrain</option>
		<option>Bajo_Nuevo_Bank_(Petrel_Is.)</option>
		<option>Bangladesh</option>
		<option>Barbados</option>
		<option>Baykonur_Cosmodrome</option>
		<option>Belarus</option>
		<option>Belgium</option>
		<option>Belize</option>
		<option>Benin</option>
		<option>Bermuda</option>
		<option>Bhutan</option>
		<option>Bolivia</option>
		<option>Bosnia_and_Herzegovina</option>
		<option>Botswana</option>
		<option>Brazil</option>
		<option>British_Indian_Ocean_Territory</option>
		<option>British_Virgin_Islands</option>
		<option>Brunei</option>
		<option>Bulgaria</option>
		<option>Burkina_Faso</option>
		<option>Burundi</option>
		<option>Cambodia</option>
		<option>Cameroon</option>
		<option>Canada</option>
		<option>Cape_Verde</option>
		<option>Caribbean_Netherlands</option>
		<option>Cayman_Islands</option>
		<option>Central_African_Republic</option>
		<option>Chad</option>
		<option>Chile</option>
		<option>China</option>
		<option>Clipperton_Island</option>
		<option>Colombia</option>
		<option>Comoros</option>
		<option>Cook_Islands</option>
		<option>Coral_Sea_Islands</option>
		<option>Costa_Rica</option>
		<option>Croatia</option>
		<option>Cuba</option>
		<option>CuracÌ§ao</option>
		<option>Cyprus</option>
		<option>Czech_Republic</option>
		<option>Democratic_Republic_of_the_Congo</option>
		<option>Denmark</option>
		<option>Dhekelia_Soverign_Base_Area</option>
		<option>Djibouti</option>
		<option>Dominica</option>
		<option>Dominican_Republic</option>
		<option>East_Timor</option>
		<option>Ecuador</option>
		<option>Egypt</option>
		<option>El_Salvador</option>
		<option>Equatorial_Guinea</option>
		<option>Eritrea</option>
		<option>Estonia</option>
		<option>Ethiopia</option>
		<option>Falkland_Islands</option>
		<option>Faroe_Islands</option>
		<option>Federated_States_of_Micronesia</option>
		<option>Fiji</option>
		<option>Finland</option>
		<option>France</option>
		<option>French_Polynesia</option>
		<option>French_Southern_and_Antarctic_Lands</option>
		<option>Gabon</option>
		<option>Gambia</option>
		<option>Gaza_Strip</option>
		<option>Georgia</option>
		<option>Germany</option>
		<option>Ghana</option>
		<option>Gibraltar</option>
		<option>Greece</option>
		<option>Greenland</option>
		<option>Grenada</option>
		<option>Guam</option>
		<option>Guatemala</option>
		<option>Guernsey</option>
		<option>Guinea</option>
		<option>Guinea_Bissau</option>
		<option>Guyana</option>
		<option>Haiti</option>
		<option>Heard_Island_and_McDonald_Islands</option>
		<option>Honduras</option>
		<option>Hong_Kong_S.A.R.</option>
		<option>Hungary</option>
		<option>Iceland</option>
		<option>India</option>
		<option>Indian_Ocean_Territories</option>
		<option>Indonesia</option>
		<option>Iran</option>
		<option>Iraq</option>
		<option>Ireland</option>
		<option>Isle_of_Man</option>
		<option>Israel</option>
		<option>Italy</option>
		<option>Ivory_Coast</option>
		<option>Jamaica</option>
		<option>Japan</option>
		<option>Jersey</option>
		<option>Jordan</option>
		<option>Kazakhstan</option>
		<option>Kenya</option>
		<option>Kiribati</option>
		<option>Kosovo</option>
		<option>Kuwait</option>
		<option>Kyrgyzstan</option>
		<option>Laos</option>
		<option>Latvia</option>
		<option>Lebanon</option>
		<option>Lesotho</option>
		<option>Liberia</option>
		<option>Libya</option>
		<option>Liechtenstein</option>
		<option>Lithuania</option>
		<option>Luxembourg</option>
		<option>Macau_S.A.R</option>
		<option>Macedonia</option>
		<option>Madagascar</option>
		<option>Malawi</option>
		<option>Malaysia</option>
		<option>Maldives</option>
		<option>Mali</option>
		<option>Malta</option>
		<option>Marshall_Islands</option>
		<option>Mauritania</option>
		<option>Mauritius</option>
		<option>Mexico</option>
		<option>Moldova</option>
		<option>Monaco</option>
		<option>Mongolia</option>
		<option>Montenegro</option>
		<option>Montserrat</option>
		<option>Morocco</option>
		<option>Mozambique</option>
		<option>Myanmar</option>
		<option>Namibia</option>
		<option>Nauru</option>
		<option>Nepal</option>
		<option>Netherlands</option>
		<option>New_Caledonia</option>
		<option>New_Zealand</option>
		<option>Nicaragua</option>
		<option>Niger</option>
		<option>Nigeria</option>
		<option>Niue</option>
		<option>Norfolk_Island</option>
		<option>North_Korea</option>
		<option>Northern_Cyprus</option>
		<option>Northern_Mariana_Islands</option>
		<option>Norway</option>
		<option>Null_Island</option>
		<option>Oman</option>
		<option>Pakistan</option>
		<option>Palau</option>
		<option>Panama</option>
		<option>Papua_New_Guinea</option>
		<option>Paraguay</option>
		<option>Peru</option>
		<option>Philippines</option>
		<option>Pitcairn_Islands</option>
		<option>Poland</option>
		<option>Portugal</option>
		<option>Puerto_Rico</option>
		<option>Qatar</option>
		<option>Republic_of_Serbia</option>
		<option>Republic_of_the_Congo</option>
		<option>Romania</option>
		<option>Russia</option>
		<option>Rwanda</option>
		<option>S._Sudan</option>
		<option>Saint_Barthelemy</option>
		<option>Saint_Helena</option>
		<option>Saint_Kitts_and_Nevis</option>
		<option>Saint_Lucia</option>
		<option>Saint_Martin</option>
		<option>Saint_Pierre_and_Miquelon</option>
		<option>Saint_Vincent_and_the_Grenadines</option>
		<option>Samoa</option>
		<option>San_Marino</option>
		<option>Sao_Tome_and_Principe</option>
		<option>Saudi_Arabia</option>
		<option>Scarborough_Reef</option>
		<option>Senegal</option>
		<option>Serranilla_Bank</option>
		<option>Seychelles</option>
		<option>Siachen_Glacier</option>
		<option>Sierra_Leone</option>
		<option>Singapore</option>
		<option>Sint_Maarten</option>
		<option>Slovakia</option>
		<option>Slovenia</option>
		<option>Solomon_Islands</option>
		<option>Somalia</option>
		<option>Somaliland</option>
		<option>South_Africa</option>
		<option>South_Georgia_and_the_Islands</option>
		<option>South_Korea</option>
		<option>Spain</option>
		<option>Spratly_Is.</option>
		<option>Sri_Lanka</option>
		<option>Sudan</option>
		<option>Suriname</option>
		<option>Swaziland</option>
		<option>Sweden</option>
		<option>Switzerland</option>
		<option>Syria</option>
		<option>Taiwan</option>
		<option>Tajikistan</option>
		<option>Thailand</option>
		<option>The_Bahamas</option>
		<option>Togo</option>
		<option>Tonga</option>
		<option>Trinidad_and_Tobago</option>
		<option>Tunisia</option>
		<option>Turkey</option>
		<option>Turkmenistan</option>
		<option>Turks_and_Caicos_Islands</option>
		<option>Tuvalu</option>
		<option>US_Naval_Base_Guantanamo_Bay</option>
		<option>Uganda</option>
		<option>Ukraine</option>
		<option>United_Arab_Emirates</option>
		<option>United_Kingdom</option>
		<option>United_Republic_of_Tanzania</option>
		<option>United_States_Minor_Outlying_Islands</option>
		<option>United_States_Virgin_Islands</option>
		<option>United_States_of_America</option>
		<option>Uruguay</option>
		<option>Uzbekistan</option>
		<option>Vanuatu</option>
		<option>Vatican</option>
		<option>Venezuela</option>
		<option>Vietnam</option>
		<option>Wallis_and_Futuna</option>
		<option>West_Bank</option>
		<option>Western_Sahara</option>
		<option>Yemen</option>
		<option>Zambia</option>
		<option>Zimbabwe</option>
	</select>

  </p>
  
  <div id="container"></div>

<script src="../js/d3.v4.min.js"></script>
<script src="../js/topojson.v1.min.js"></script>


<script>
d3.select(window).on("resize", throttle);

var color = d3.scaleOrdinal(d3.schemeCategory20);

var c = document.getElementById('container');
var width = c.offsetWidth;
var height = width / 2;

var topo,projection,path,svg,g;

var offsetL = c.offsetLeft+20;
var offsetT = c.offsetTop+10;

var tooltip = d3.select("#container").append("div").attr("class", "tooltip hidden");

setup(width,height);

function setup(width,height){

  projection = d3.geoMercator();

  path = d3.geoPath().projection(projection);

  svg = d3.select("#container").append("svg")
      .attr("width", width)
      .attr("height", height)
      //zoom in v4: https://jsfiddle.net/gerardofurtado/c8bga82b/
      .call(d3.zoom().on("zoom", function () {
            svg.attr("transform", d3.event.transform)
        }))
      .on("click", click)
      .append("g");

  g = svg.append("g");

}

function handleMouseOver(){
  var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );

  tooltip.classed("hidden", false)
    .attr("style", "left:"+(mouse[0]+offsetL)+"px;top:"+(mouse[1]+offsetT)+"px")
    .html(this.__data__.properties.name);
}

function handleMouseOut(){
  tooltip.classed("hidden", true);
}

//get country name, else world?? click on world zooms into country?
var countryname = window.location.search.substr(1).replace("country=","");
if(countryname!==""){
	//capitalize
	var cname = countryname.charAt(0).toUpperCase()+countryname.slice(1);
} else {
	//load world?
	var cname = "Canada";
}
//update dropdown
document.getElementById("selectBox").value=cname;

d3.json("../data/world/country/"+cname+".topo.json", function(error, map) {

  var countries = topojson.feature(map, map.objects.map);

  topo = countries;
  draw(topo);

});

function draw(topo) {

	//zoom to topojson feature
	var b = path.bounds(topo);
	var s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height);
	var t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];

	g.attr("transform", "translate(" + t + ")scale(" + s + ")");

    var country = g.selectAll(".country").data(topo.features);

    country.enter().insert("path")
      .attr("d", path)
      .attr("id", function(d,i) { return d.id; })
      .attr("title", function(d,i) { return d.properties.name_alt; })
      .style("fill", function(d, i) { return color(d.id.toLowerCase().replace(/.*-/,"")); })
      .on("mouseover", handleMouseOver)
      .on("mouseout", handleMouseOut);

}

function redraw() {
  width = c.offsetWidth;
  height = width / 2;
  d3.select('svg').remove();
  setup(width,height);
  draw(topo);
}

var throttleTimer;
function throttle() {
  window.clearTimeout(throttleTimer);
    throttleTimer = window.setTimeout(function() {
      redraw();
    }, 200);
}


//geo translation on mouse click in map
function click() {
  var latlon = projection.invert(d3.mouse(this));
  console.log(latlon);
}
</script>
</body>
</html>
